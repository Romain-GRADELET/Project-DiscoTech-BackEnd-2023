{{ form_start(form) }}
    {{ form_widget(form) }}
    
    <h3>Songs</h3>
    <ul class="Songs">
        {% for song in form.songs %}
            <li>{{ form_row(song.trackNb) }}</li>
            <li>{{ form_row(song.title) }}</li>
            <li>{{ form_row(song.duration) }}</li>
            <li>{{ form_row(song.preview) }}</li>
        {% endfor %}
        <li data-index="{{ form.songs|length > 0 ? form.songs|last.vars.song + 1 : 0 }}"
            data-prototype="{{ form_widget(form.songs.vars.prototype)|e('html_attr') }}">
            <button type="button" class="add_item_link" data-collection-holder-class="s">Add a song</button>
        </li>
    </ul>

    <div class="d-flex justify-content-end">
        <button class="btn btn-warning me-5">{{ button_label|default('Sauvegarder') }}</button>
    </div>
{{ form_end(form) }}

<script> document
  .querySelectorAll('.add_item_link')
  .forEach(btn => {
      btn.addEventListener("click", addFormToCollection)
  }); 
  
  const addFormToCollection = (e) => {
  const collectionHolder = document.querySelector('.' + e.currentTarget.dataset.collectionHolderClass);

  const item = document.createElement('li');

  item.innerHTML = collectionHolder
    .dataset
    .prototype
    .replace(
      /__song__/g,
      collectionHolder.dataset.index
    );

  collectionHolder.appendChild(item);

  collectionHolder.dataset.index++;
};

</script>
